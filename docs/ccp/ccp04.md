# 第四章 存储器

### 4.1 概述

一、存储器分类

1. 按存储介质分类
    1. 半导体存储器     TTL、MOS
    2. 磁表面存储器     磁头、载磁体
    3. 磁芯存储器       硬磁材料、环状元件
    4. 光盘存储器       激光、磁光材料
   
    **其实是按半导体和磁材料，半导体有易失性、磁材料非易失性**

2. 按存取方式分类
   1. 存取时间与物理地址无关（随机访问）
       + 随机存储器：在程序的执行过程中可读可写
       + 只读存储器：在程序的执行过程中只读
    2. 存取时间与物理地址有关（串行访问）
       + 顺序存取存储器  磁带
       + 直接存取存储器  磁盘
    3. 按在计算机中的作用分类

    ![ccp04-01](/images/ccp04-01.png ':size=40%')

二、存储器的层次结构

存储器三个主要特性：速度、容量和价格/位

![ccp04-02](/images/ccp04-02.png ':size=30%')

缓存-主存层次和主存-辅存层次

![ccp04-03](/images/ccp04-03.png ':size=50%')


### 4.2 主存储器

一、概述

1.主存的基本组成

![ccp04-04](/images/ccp04-04.png ':size=40%')

2.主存和CPU的联系

![ccp04-05](/images/ccp04-05.png ':size=40%')

3.主存中存储单元地址的分配

+ 高位字节地址为字地址（大端、大尾方式）
+ 地位字节地址为字地址（小端、小尾方式）

4.主存的技术指标

+ 存储容量：主存存放二进制代码的总位数
+ 存储速度：
   + 存取时间：存储器的访问时间(读出时间、写入时间)
   + 存取周期： 连续两次独立的存储器操作(读或写)所需的最小间隔时间
+ 存储器的带宽：单位时间内存储器存取的信息量，单位：位/秒

二、半导体存储芯片简介

半导体芯片的基本结构

![ccp04-06](/images/ccp04-06.png ':size=40%')

地址线单向输入,数据线是双向的，假设地址线是10条，数据线有4条，芯片容量为2<sup>10</sup>×4 = 4K位

片选线  <span style="text-decoration: overline">CS</span> 
<span style="text-decoration: overline">CE</span>

读/写控制线  <span style="text-decoration: overline">WE</span>(低电平写、高电平读) 

<span style="text-decoration: overline">OE</span> (允许读) <span style="text-decoration: overline">WE</span> (允许写) 

半导体存储芯片的译码驱动方式
1. 线选法：相当于把存储单元变成一个数组。只适用于容量不大的存储芯片
2. 重合法：相当于把存储单元变成一个矩阵。

三、随机存储存储器(RAM)

1.静态RAM(SRM)

静态RAM是用触发器工作原理存储信息，即使信息读出后，仍保持其原状态，不需要再生，但电源掉电时，原存信息丢失，故它属于易失去性半导体存储器

2.动态RAM(DRAM)

常见的动态RAM基本电路有三管式和单管式，它们的共同特点都是靠电容存储电荷的原理来寄存信息

动态RAM刷新与行地址有关
1. 集中刷新：在一个规定的刷新周期内，对全部存储单元集中一段时间逐行刷新，此刻必须停止读/写操作（其间不能进行读/写操作称为“死区”）
2. 分散刷新：对每行存储单元的刷新分散到每个存取周内完成
3. 异步刷新：将刷新安排在指令译码阶段，不会出现“死区”

3.动态RAM和静态RAM的比较


![ccp04-07](/images/ccp04-07.png ':size=35%')

四、只读存储器(ROM)
1. 掩膜ROM(MROM)：只能读，任何信息不能修改
2. PROM(一次性编程)：通过熔丝实现一次性编程
3. EPROM(多次性编程)： 通过紫外线照射浮动栅进行驱散
4. EEPROM(多次性编程)：电可擦写，即可局部擦写也可全部擦写
5. Flash Memory(闪速型存储器)

五、存储器与CPU的连接

存储器容量的扩展：
1. 位扩展：增加存储字长
2. 字扩展：增加存储器字的数量
3. 字、位扩展：即增加存储字的数量，又增加存储字长

存储器与CPU的连接
1. 地址线的连接
2. 数据线的连接
3. 读/写命令线的连接
4. 片选线的连接
5. 合理选择存储芯片

存储器的校验

编码的最小距离：任意两组合法代码之间二进制位数的最少差异

编码的纠错、检错能力与编码的最小距离有关

**L - 1 = D + C (D>=C)**
+ L：编码的最小距离
+ D：检测错误的位数
+ C：纠正错误的位数

汉明码是具有一位纠错能力的编码
+ 汉明码采用奇偶校验
+ 汉明码采用分组校验
+ 汉明码的分组是一种非划分方式

+ 汉明码的组成需增添2<sup>k</sup> >= n + k + 1
+ 检测位的位置2<sup>i</sup> (i=0,1,2,3,...)
+ 检测位的取值与该位所在检测小组承担的奇偶校验任务有关

提高访存速度的措施
+ 采用高速器件
+ 采用层次结构Cache-主存
+ 调整主存结构
  1.  单体多字系统：增加存储器的带宽
  2.  多体并行系统：高位交叉(顺序编址)、低位交叉（各个体轮流编址）
  3.  高性能存储芯片：SDRAM、RDRAM、带Cache的DRAM

### 4.3 高速缓冲存储器

一、概述

1.问题的提出

+ 避免CPU“空等”现象
+ CPU和主存(DRAM)的速度差异
+ 程序访问的局部性原理

2.Cache的工作原理

主存和缓存按块存储

块的大小相同

+ 命中：主存块调入缓存，主存块与缓存块建立了对应关系
+ 未命中：主存块未调入缓存，主存块与缓存块为建立对应关系

用标记记录与某缓存块建立了对应关系的主存块号

Cache的命中率：CPU欲访问的信息在Cache中的比率

命中率与Cache的容量与块长有关

Cache-主存系统的效率e与命中率有关

![ccp04-08](/images/ccp04-08.png ':size=35%')


3.Cache的基本结构

![ccp04-09](/images/ccp04-09.png ':size=70%')

+ Cache存储体
+ 地址映射变换机构
+ Cache替换机构

Cache的读写操作

读操作

![ccp04-10](/images/ccp04-10.png ':size=60%')

写操作

+ 写直达法：写操作时数据既写入Cache又写入主存
  + 写操作时间就是访问主存时间，Cache块退出时不需要对主存执行写操作，更新策略比较容易实现
+ 写回法：写操作时只把数据写入Cache而不写入主存，当Cache数据被替换出去时才写回主存
  + 写操作时间就是访问Cache的时间，Cache块退出时，被替换的块需写回主存，增加了Cache的复杂性

4.Cache的改进
  1. 增加Cache的级数
  2. 统一缓存和分立缓存

二、Cache-主存地址映射

1.直接映射

某一主存块只能固定映射到某一缓存块

2.全相联映射

某一主存块能映射到任一缓存块

3.组相联映射

某一主存块只能映射到某一缓存组中的任一块

三、替换算法

1. 先进先出(FIFO)算法
2. 近期最少使用(LRU)算法

### 4.4 辅助存储器

1.特点   不直接与CPU交换信息
2.磁表面存储器的技术指标
   1. 记录密度    道密度D<sub>t</sub>,位密度D<sub>b</sub>
   2. 存储容量    C = n*k*s
   3. 平均寻址时间      寻道时间+等待时间
   4. 数据传输率     D<sub>r</sub> = D<sub>b</sub>*V
   5. 误码率      出错信息位数与读出信息的总位数的比值

硬磁盘存储器的类型
1. 固定磁头和移动磁头
2. 可换盘和固定盘

硬磁盘存储器结构

![ccp04-11](/images/ccp04-11.png ':size=40%')

软磁盘存储器

光磁盘存储器：采用光存储技术